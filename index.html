<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/WhatsApp_icon.png/479px-WhatsApp_icon.png" type="image/x-icon">
    <title>Form Nomor Handphone</title>

    <!-- Load Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        .icon-label {
            display: block;
            text-align: center;
            font-size: 12px; /* Adjust the font size as needed */
        }
        .w-message {
            display: inline;
        }
        .instant-mode {
            display: none;
        }
        .btn {
            padding: 0.75rem 1.5rem;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="card">
        <div class="card-header">Form Nomor Handphone</div>
        <div class="card-body">
            <form id="phoneForm">
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Nomor Handphone</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" placeholder="Masukkan nomor handphone" required>
                        <a id="copyButton" type="button" class="btn btn-outline-secondary">
                            <i class="fas fa-copy"></i>
                            <span class="icon-label">salin</span>
                        </a>
                        <a id="pasteButton" class="btn btn-outline-secondary">
                            <i class="fas fa-paste"></i>
                            <span class="icon-label">tempel</span>
                        </a>
                    </div>
                    <div id="phoneError" class="invalid-feedback"></div>
                    <div class="form-check mx-2 my-2">
                        <input class="form-check-input" type="checkbox" value="" id="checkPesan" checked>
                        <label class="form-check-label" for="checkPesan">
                            Sertakan pesan
                        </label>
                    </div>
                    <div class="w-message">
                        <div class="form-group mx-2 my-2 pb-2">
                            <label for="driverMode" class="my-2">Driver Mode</label>
                            <select class="form-control" id="driverMode">
                                <option value="food" selected>Food</option>
                                <option value="instant">Instant</option>
                            </select>
                        </div>
                        <div class="instant-mode">
                            <label for="receiverName" class="form-label mx-2">Nama Penerima</label>
                            <div class="form-group mx-2 mb-3">
                                <input type="text" class="form-control" id="receiverName" name="receiverName" placeholder="Masukkan nama penerima">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary" id="sendButton">Validasi</button>
                </div>
                <a id="reloadButton" class="btn btn-sm"><i class="fas fa-redo fa-sm"></i> Reset</a>
            </form>
        </div>
    </div>
</div>

<!-- Load Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        $('#receiverName').on('keyup', function (e) {
            e.preventDefault();
            resetButtonSend();
        });

        $('#driverMode').on('change', function (e) {
            e.preventDefault();
            const driverMode = $(this).val();
            if (driverMode === 'instant') {
                $('.instant-mode').show();
                $('#receiverName').attr('required', true);
            } else {
                $('.instant-mode').hide();
                $('#receiverName').attr('required', false);
            }
            resetButtonSend();
        });

        $('#phoneNumber').on('keyup', function (e) {
            e.preventDefault();
            resetButtonSend();
        });

        $('#pasteButton').click(function () {
            navigator.clipboard.readText()
                .then(function (text) {
                    $('#phoneNumber').val(text);
                    resetButtonSend();
                })
                .catch(function (err) {
                    console.error('Gagal melakukan paste: ', err);
                });
        });

        $('#checkPesan').change(function (e) {
            e.preventDefault();
            const checkPesan = $(this).is(':checked');
            if (checkPesan) {
                $('.w-message').show();
                if ($('#driverMode').val() === 'instant') {
                    $('.instant-mode').show();
                    $('#receiverName').attr('required', true);
                }
            } else {
                $('.w-message').hide();
            }
            resetButtonSend();
        });

        $('#reloadButton').click(function () {
            $('#phoneForm').trigger('reset');
            $('#phoneForm #sendButton').replaceWith('<button type="submit" class="btn btn-primary">Validasi</button>');
            $('#phoneNumber').attr('readonly', false);
            $('.w-message').show();
            $('.instant-mode').hide();
            $('#receiverName').attr('required', false);
        });

        $('#copyButton').click(function () {
            const phoneNumberValue = $('#phoneNumber').val();
            navigator.clipboard.writeText(phoneNumberValue)
                .then(function () {
                    $('#phoneError').text('Nomor handphone berhasil disalin').show().delay(700).fadeOut('slow');
                })
                .catch(function (err) {
                    console.error('Gagal menyalin nomor handphone: ', err);
                });
        });

        $('#phoneForm').submit(function (e) {
            e.preventDefault();
            const phoneNumber = $('#phoneNumber').val();
            const checkPesan = $('#checkPesan').is(':checked');
            const instantMode = $('#driverMode').val() === 'instant';
            const receiverName = $('#receiverName').val();

            const { phoneNumberCleaned, errorMessage } = cleanPhoneNumber(phoneNumber);
            if (errorMessage) {
                $('#phoneError').text(errorMessage).show().delay(700).fadeOut('slow');
                return;
            }

            let message = '';
            let driverName = 'ShopeeFood Driver';
            if (instantMode) {
                driverName = 'Shopee Instant Driver';
                const receiverText = receiverName ? 'atas nama ' + receiverName : 'Shopee Instant';
                message = `\nPesanan ${receiverText} sedang dalam perjalanan menuju lokasi Anda.` +
                    `\n\nApabila pembeli sedang tidak berada di lokasi, mohon untuk konfirmasi peletakan paket melalui chat ini.` +
                    `\nMohon ditunggu.`;
            } else {
                message = 'Apakah alamat yang tertera di aplikasi sudah benar?';
            }

            if (checkPesan) {
                const templateMessage = `Halo, saya ${driverName}.` +
                    `\nSaya sedang mengantar pesanan Anda.` +
                    `\n${message}` +
                    `\n\nTerima kasih.`;
                message = encodeURIComponent(templateMessage);
            }

            const waUrl = `https://wa.me/${phoneNumberCleaned}?text=${message}`;
            const button = `<a href="${waUrl}" class="btn btn-success" target="_blank" id="sendButton">Kirim</a>`;
            $('#phoneForm button[type="submit"]').replaceWith(button);
            $('#phoneNumber').val(`https://wa.me/${phoneNumberCleaned}`);
        });

        function cleanPhoneNumber(phoneNumber) {
            const phoneNumberCleaned = phoneNumber.replace(/[^0-9]/g, '');
            if (phoneNumberCleaned.length < 7) {
                return { phoneNumberCleaned, errorMessage: 'Nomor telepon tidak valid' };
            }
            if (phoneNumberCleaned.startsWith('0')) {
                return { phoneNumberCleaned: '62' + phoneNumberCleaned.slice(1), errorMessage: null };
            }
            if (phoneNumberCleaned.startsWith('8')) {
                return { phoneNumberCleaned: '62' + phoneNumberCleaned, errorMessage: null };
            }
            return { phoneNumberCleaned, errorMessage: null };
        }

        function resetButtonSend() {
            const buttonSend = $('#phoneForm #sendButton').text();
            if (buttonSend === 'Kirim') {
                const button = '<button type="submit" class="btn btn-primary" id="sendButton">Validasi</button>';
                $('#phoneForm #sendButton').replaceWith(button);
            }
        }
    });
</script>

</body>
</html>